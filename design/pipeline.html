<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeSentinel - 流水线</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #000;
            color: #e2e8f0;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- Icons ---
        const Icons = {
            Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" />,
            GitPullRequest: <><circle cx="18" cy="18" r="3" /><circle cx="6" cy="6" r="3" /><path d="M13 6h3a2 2 0 0 1 2 2v7" /><line x1="6" x2="6" y1="9" y2="21" /></>,
            GitMerge: <><circle cx="18" cy="18" r="3" /><circle cx="6" cy="6" r="3" /><path d="M6 21V9a9 9 0 0 0 9 9" /></>,
            CheckCircle2: <><circle cx="12" cy="12" r="10" /><path d="m9 12 2 2 4-4" /></>,
            XCircle: <><circle cx="12" cy="12" r="10" /><path d="m15 9-6 6" /><path d="m9 9 6 6" /></>,
            Loader2: <path d="M21 12a9 9 0 1 1-6.219-8.56" />,
            Clock: <><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></>,
            Search: <><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></>,
            Filter: <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />,
            ChevronRight: <path d="m9 18 6-6-6-6" />,
            ChevronDown: <path d="m6 9 6 6 6-6" />,
            RotateCcw: <><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 3v9h9" /></>,
            X: <path d="M18 6 6 18M6 6l12 12" />,
            Play: <polygon points="5 3 19 12 5 21 5 3" />,
            Pause: <><rect width="4" height="16" x="6" y="4" /><rect width="4" height="16" x="14" y="4" /></>,
            Eye: <><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" /><circle cx="12" cy="12" r="3" /></>,
            Zap: <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />,
            FileText: <><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /></>,
            Activity: <path d="M22 12h-4l-3 9L9 3l-3 9H2" />,
            AlertTriangle: <><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><line x1="12" x2="12" y1="9" y2="13" /><line x1="12" x2="12.01" y1="17" y2="17" /></>,
            Code: <><polyline points="16 18 22 12 16 6" /><polyline points="8 6 2 12 8 18" /></>,
            TestTube: <><path d="M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2" /><path d="M8.5 2h7" /><path d="M14.5 16h-5" /></>,
            Terminal: <><polyline points="4 17 10 11 4 5" /><line x1="12" x2="20" y1="19" y2="19" /></>,
            ArrowLeft: <><path d="m12 19-7-7 7-7" /><path d="M19 12H5" /></>,
            Download: <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>,
            ExternalLink: <><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" x2="21" y1="14" y2="3" /></>,
            Calendar: <><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></>,
            User: <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>,
            Timer: <><line x1="10" x2="14" y1="2" y2="2" /><line x1="12" x2="15" y1="14" y2="11" /><circle cx="12" cy="14" r="8" /></>,
            Sparkles: <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z" />,
            Settings: <><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></>
        };

        const Lucide = ({ name, className, size = 16 }) => {
            const icon = Icons[name];
            return icon ? (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icon}
                </svg>
            ) : null;
        };

        // --- Navbar ---
        const Navbar = ({ active }) => (
            <nav className="h-16 flex items-center justify-between px-8 border-b border-white/5 bg-[#0A0A0A]/80 backdrop-blur-md sticky top-0 z-50">
                <div className="flex items-center gap-8">
                    <a href="index.html" className="flex items-center gap-3 group">
                        <div className="w-9 h-9 rounded-xl bg-indigo-600 flex items-center justify-center shadow-lg shadow-indigo-500/20 group-hover:scale-105 transition-transform">
                            <Lucide name="Shield" className="text-white" size={20} />
                        </div>
                        <span className="font-bold text-xl tracking-tight text-white group-hover:text-white/90 transition-colors">
                            CodeSentinel <span className="text-indigo-400 text-xs ml-1 font-normal bg-indigo-500/10 px-1.5 py-0.5 rounded border border-indigo-500/20">Ent</span>
                        </span>
                    </a>
                    <div className="hidden md:flex items-center bg-white/5 rounded-lg p-1 border border-white/5">
                        {[
                            { id: 'overview', label: '仪表盘', href: 'overview.html' },
                            { id: 'workspace', label: '工作台', href: 'workspace.html' },
                            { id: 'mapping', label: '需求映射', href: 'mapping.html' },
                            { id: 'pipeline', label: '流水线', href: 'pipeline.html' },
                            { id: 'configuration', label: '仓库配置', href: 'configuration.html' }
                        ].map((item) => (
                            <a key={item.id} href={item.href} className={`px-5 py-1.5 rounded-md text-sm font-medium transition-all ${active === item.id ? 'bg-white/10 text-white shadow-sm' : 'text-white/40 hover:text-white/80 hover:bg-white/5'}`}>
                                {item.label}
                            </a>
                        ))}
                    </div>
                </div>
                <div className="flex items-center gap-4">
                    <a href="settings.html" className="p-2 rounded-lg hover:bg-white/5 text-white/40 hover:text-white transition-all" title="系统设置">
                        <Lucide name="Settings" size={20} />
                    </a>
                    <div className="flex items-center gap-3 pl-4 border-l border-white/10">
                        <div className="flex flex-col items-end">
                            <span className="text-xs font-medium text-white">张三 (Dev)</span>
                            <span className="text-[10px] text-white/40">GitLab Pro</span>
                        </div>
                        <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 p-[1px]">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" className="w-full h-full rounded-full bg-black" />
                        </div>
                    </div>
                </div>
            </nav>
        );

        // --- Mock Data ---
        const PIPELINES = [
            {
                id: '#2847',
                status: 'success',
                branch: 'feat/shipping-logic',
                commit: 'a1b2c3d',
                commitMsg: 'fix: 修复Level 2用户运费计算逻辑',
                project: '电商核心交易系统',
                triggeredBy: '张三',
                triggeredAt: '2 分钟前',
                duration: '3m 42s',
                stages: [
                    { name: '影响分析', status: 'success', duration: '32s' },
                    { name: '生成用例', status: 'success', duration: '45s' },
                    { name: '执行测试', status: 'success', duration: '1m 20s' },
                    { name: '自动修复', status: 'success', duration: '55s' },
                    { name: '验证通过', status: 'success', duration: '10s' },
                ],
                testsTotal: 12,
                testsPassed: 12,
                coverage: 92.5,
                aiInsights: 3,
                fixes: 1
            },
            {
                id: '#2846',
                status: 'running',
                branch: 'feat/user-auth-v2',
                commit: 'e4f5g6h',
                commitMsg: 'feat: 添加OAuth2.0认证支持',
                project: '用户中心微服务',
                triggeredBy: '李四',
                triggeredAt: '5 分钟前',
                duration: '2m 15s',
                stages: [
                    { name: '影响分析', status: 'success', duration: '28s' },
                    { name: '生成用例', status: 'success', duration: '52s' },
                    { name: '执行测试', status: 'running', duration: '55s' },
                    { name: '自动修复', status: 'pending', duration: '-' },
                    { name: '验证通过', status: 'pending', duration: '-' },
                ],
                testsTotal: 8,
                testsPassed: 5,
                coverage: 78.2,
                aiInsights: 2,
                fixes: 0
            },
            {
                id: '#2845',
                status: 'failed',
                branch: 'fix/inventory-bug',
                commit: 'i7j8k9l',
                commitMsg: 'fix: 修复库存扣减并发问题',
                project: '电商核心交易系统',
                triggeredBy: '王五',
                triggeredAt: '15 分钟前',
                duration: '4m 18s',
                stages: [
                    { name: '影响分析', status: 'success', duration: '35s' },
                    { name: '生成用例', status: 'success', duration: '48s' },
                    { name: '执行测试', status: 'failed', duration: '2m 05s' },
                    { name: '自动修复', status: 'skipped', duration: '-' },
                    { name: '验证通过', status: 'skipped', duration: '-' },
                ],
                testsTotal: 15,
                testsPassed: 11,
                coverage: 68.5,
                aiInsights: 5,
                fixes: 0,
                failureReason: '测试用例 test_concurrent_inventory_deduct 断言失败: 期望库存 95，实际 90'
            },
            {
                id: '#2844',
                status: 'success',
                branch: 'main',
                commit: 'm0n1o2p',
                commitMsg: 'chore: 更新依赖版本',
                project: '支付网关服务',
                triggeredBy: '赵六',
                triggeredAt: '1 小时前',
                duration: '2m 08s',
                stages: [
                    { name: '影响分析', status: 'success', duration: '22s' },
                    { name: '生成用例', status: 'success', duration: '38s' },
                    { name: '执行测试', status: 'success', duration: '58s' },
                    { name: '自动修复', status: 'skipped', duration: '-' },
                    { name: '验证通过', status: 'success', duration: '10s' },
                ],
                testsTotal: 6,
                testsPassed: 6,
                coverage: 95.0,
                aiInsights: 1,
                fixes: 0
            },
            {
                id: '#2843',
                status: 'cancelled',
                branch: 'feat/payment-refund',
                commit: 'q3r4s5t',
                commitMsg: 'feat: 实现退款功能',
                project: '支付网关服务',
                triggeredBy: '张三',
                triggeredAt: '2 小时前',
                duration: '1m 35s',
                stages: [
                    { name: '影响分析', status: 'success', duration: '30s' },
                    { name: '生成用例', status: 'cancelled', duration: '1m 05s' },
                    { name: '执行测试', status: 'skipped', duration: '-' },
                    { name: '自动修复', status: 'skipped', duration: '-' },
                    { name: '验证通过', status: 'skipped', duration: '-' },
                ],
                testsTotal: 0,
                testsPassed: 0,
                coverage: 0,
                aiInsights: 0,
                fixes: 0
            }
        ];

        // --- Components ---
        const StatusBadge = ({ status, size = 'md' }) => {
            const config = {
                success: { icon: 'CheckCircle2', color: 'text-emerald-400', bg: 'bg-emerald-500/10', border: 'border-emerald-500/20', label: '成功' },
                running: { icon: 'Loader2', color: 'text-indigo-400', bg: 'bg-indigo-500/10', border: 'border-indigo-500/20', label: '运行中', spin: true },
                failed: { icon: 'XCircle', color: 'text-rose-400', bg: 'bg-rose-500/10', border: 'border-rose-500/20', label: '失败' },
                cancelled: { icon: 'X', color: 'text-white/40', bg: 'bg-white/5', border: 'border-white/10', label: '已取消' },
                pending: { icon: 'Clock', color: 'text-white/40', bg: 'bg-white/5', border: 'border-white/10', label: '等待中' },
                skipped: { icon: 'ChevronRight', color: 'text-white/30', bg: 'bg-white/5', border: 'border-white/5', label: '跳过' }
            };
            const { icon, color, bg, border, label, spin } = config[status] || config.pending;
            const sizeClass = size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-3 py-1 text-xs';

            return (
                <span className={`inline-flex items-center gap-1.5 ${sizeClass} ${bg} ${color} ${border} border rounded-full font-bold`}>
                    <Lucide name={icon} size={size === 'sm' ? 10 : 12} className={spin ? 'animate-spin' : ''} />
                    {label}
                </span>
            );
        };

        const StageProgress = ({ stages, compact = false }) => {
            return (
                <div className={`flex items-center ${compact ? 'gap-1' : 'gap-2'}`}>
                    {stages.map((stage, idx) => {
                        const colors = {
                            success: 'bg-emerald-500',
                            running: 'bg-indigo-500 animate-pulse',
                            failed: 'bg-rose-500',
                            cancelled: 'bg-white/30',
                            pending: 'bg-white/10',
                            skipped: 'bg-white/10'
                        };
                        return (
                            <div key={idx} className="relative group">
                                <div
                                    className={`${compact ? 'w-6 h-1.5' : 'w-10 h-2'} rounded-full ${colors[stage.status]} transition-all`}
                                    title={`${stage.name}: ${stage.status}`}
                                />
                                {!compact && (
                                    <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-black border border-white/10 rounded text-[10px] text-white/80 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10">
                                        {stage.name} ({stage.duration})
                                    </div>
                                )}
                            </div>
                        );
                    })}
                </div>
            );
        };

        // --- Pipeline Detail View ---
        const PipelineDetail = ({ pipeline, onBack }) => {
            const [activeTab, setActiveTab] = useState('stages');

            return (
                <div className="fade-in">
                    {/* Detail Header */}
                    <div className="bg-[#0F0F0F] border-b border-white/5 px-8 py-6">
                        <div className="max-w-[1400px] mx-auto">
                            <button onClick={onBack} className="flex items-center gap-2 text-white/40 hover:text-white text-sm mb-6 transition-colors">
                                <Lucide name="ArrowLeft" size={16} /> 返回列表
                            </button>
                            <div className="flex items-start justify-between">
                                <div className="flex items-start gap-6">
                                    <div className={`w-16 h-16 rounded-2xl flex items-center justify-center ${
                                        pipeline.status === 'success' ? 'bg-emerald-500/20 text-emerald-400' :
                                        pipeline.status === 'running' ? 'bg-indigo-500/20 text-indigo-400' :
                                        pipeline.status === 'failed' ? 'bg-rose-500/20 text-rose-400' :
                                        'bg-white/10 text-white/40'
                                    }`}>
                                        <Lucide name={
                                            pipeline.status === 'success' ? 'CheckCircle2' :
                                            pipeline.status === 'running' ? 'Loader2' :
                                            pipeline.status === 'failed' ? 'XCircle' : 'X'
                                        } size={32} className={pipeline.status === 'running' ? 'animate-spin' : ''} />
                                    </div>
                                    <div>
                                        <div className="flex items-center gap-3 mb-2">
                                            <h2 className="text-2xl font-bold text-white">流水线 {pipeline.id}</h2>
                                            <StatusBadge status={pipeline.status} />
                                        </div>
                                        <p className="text-white/60 mb-3">{pipeline.commitMsg}</p>
                                        <div className="flex items-center gap-4 text-xs text-white/40">
                                            <span className="flex items-center gap-1.5 bg-white/5 px-2 py-1 rounded">
                                                <Lucide name="GitMerge" size={12} className="text-orange-400" /> {pipeline.branch}
                                            </span>
                                            <span className="flex items-center gap-1.5">
                                                <Lucide name="Code" size={12} /> {pipeline.commit}
                                            </span>
                                            <span className="flex items-center gap-1.5">
                                                <Lucide name="User" size={12} /> {pipeline.triggeredBy}
                                            </span>
                                            <span className="flex items-center gap-1.5">
                                                <Lucide name="Clock" size={12} /> {pipeline.triggeredAt}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex items-center gap-3">
                                    {pipeline.status === 'failed' && (
                                        <button className="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm font-bold flex items-center gap-2 transition-colors">
                                            <Lucide name="RotateCcw" size={14} /> 重试
                                        </button>
                                    )}
                                    {pipeline.status === 'running' && (
                                        <button className="px-4 py-2 bg-rose-600/20 hover:bg-rose-600/30 text-rose-400 border border-rose-500/20 rounded-lg text-sm font-bold flex items-center gap-2 transition-colors">
                                            <Lucide name="X" size={14} /> 取消
                                        </button>
                                    )}
                                    <button className="px-4 py-2 bg-white/5 hover:bg-white/10 text-white/60 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                                        <Lucide name="Download" size={14} /> 导出报告
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Stats Bar */}
                    <div className="bg-[#0A0A0A] border-b border-white/5 px-8 py-4">
                        <div className="max-w-[1400px] mx-auto flex items-center gap-8">
                            <div className="flex items-center gap-3">
                                <div className="p-2 bg-white/5 rounded-lg">
                                    <Lucide name="Timer" size={18} className="text-white/40" />
                                </div>
                                <div>
                                    <div className="text-xs text-white/40">总耗时</div>
                                    <div className="text-lg font-bold text-white">{pipeline.duration}</div>
                                </div>
                            </div>
                            <div className="w-px h-10 bg-white/10" />
                            <div className="flex items-center gap-3">
                                <div className="p-2 bg-white/5 rounded-lg">
                                    <Lucide name="TestTube" size={18} className="text-white/40" />
                                </div>
                                <div>
                                    <div className="text-xs text-white/40">测试通过</div>
                                    <div className="text-lg font-bold text-white">
                                        <span className={pipeline.testsPassed === pipeline.testsTotal ? 'text-emerald-400' : 'text-rose-400'}>
                                            {pipeline.testsPassed}
                                        </span>
                                        <span className="text-white/40">/{pipeline.testsTotal}</span>
                                    </div>
                                </div>
                            </div>
                            <div className="w-px h-10 bg-white/10" />
                            <div className="flex items-center gap-3">
                                <div className="p-2 bg-white/5 rounded-lg">
                                    <Lucide name="Activity" size={18} className="text-white/40" />
                                </div>
                                <div>
                                    <div className="text-xs text-white/40">代码覆盖率</div>
                                    <div className={`text-lg font-bold ${pipeline.coverage >= 80 ? 'text-emerald-400' : pipeline.coverage >= 60 ? 'text-amber-400' : 'text-rose-400'}`}>
                                        {pipeline.coverage}%
                                    </div>
                                </div>
                            </div>
                            <div className="w-px h-10 bg-white/10" />
                            <div className="flex items-center gap-3">
                                <div className="p-2 bg-white/5 rounded-lg">
                                    <Lucide name="Sparkles" size={18} className="text-white/40" />
                                </div>
                                <div>
                                    <div className="text-xs text-white/40">AI 洞察</div>
                                    <div className="text-lg font-bold text-indigo-400">{pipeline.aiInsights}</div>
                                </div>
                            </div>
                            <div className="w-px h-10 bg-white/10" />
                            <div className="flex items-center gap-3">
                                <div className="p-2 bg-white/5 rounded-lg">
                                    <Lucide name="Zap" size={18} className="text-white/40" />
                                </div>
                                <div>
                                    <div className="text-xs text-white/40">自动修复</div>
                                    <div className="text-lg font-bold text-amber-400">{pipeline.fixes}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Tabs */}
                    <div className="px-8 py-6">
                        <div className="max-w-[1400px] mx-auto">
                            <div className="flex items-center gap-1 mb-6 bg-white/5 p-1 rounded-lg w-fit border border-white/5">
                                {[
                                    { id: 'stages', label: '阶段详情', icon: 'Activity' },
                                    { id: 'logs', label: '执行日志', icon: 'Terminal' },
                                    { id: 'tests', label: '测试报告', icon: 'TestTube' },
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`px-4 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${
                                            activeTab === tab.id ? 'bg-white/10 text-white' : 'text-white/40 hover:text-white/80'
                                        }`}
                                    >
                                        <Lucide name={tab.icon} size={14} /> {tab.label}
                                    </button>
                                ))}
                            </div>

                            {/* Stages Content */}
                            {activeTab === 'stages' && (
                                <div className="space-y-4">
                                    {pipeline.stages.map((stage, idx) => (
                                        <div key={idx} className={`bg-[#0F0F0F] border rounded-xl p-6 ${
                                            stage.status === 'failed' ? 'border-rose-500/30' :
                                            stage.status === 'running' ? 'border-indigo-500/30' :
                                            'border-white/5'
                                        }`}>
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-4">
                                                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${
                                                        stage.status === 'success' ? 'bg-emerald-500/20 text-emerald-400' :
                                                        stage.status === 'running' ? 'bg-indigo-500/20 text-indigo-400' :
                                                        stage.status === 'failed' ? 'bg-rose-500/20 text-rose-400' :
                                                        'bg-white/5 text-white/30'
                                                    }`}>
                                                        {stage.status === 'success' && <Lucide name="CheckCircle2" size={20} />}
                                                        {stage.status === 'running' && <Lucide name="Loader2" size={20} className="animate-spin" />}
                                                        {stage.status === 'failed' && <Lucide name="XCircle" size={20} />}
                                                        {(stage.status === 'pending' || stage.status === 'skipped' || stage.status === 'cancelled') && <Lucide name="Clock" size={20} />}
                                                    </div>
                                                    <div>
                                                        <div className="text-white font-bold">{stage.name}</div>
                                                        <div className="text-xs text-white/40">阶段 {idx + 1} / {pipeline.stages.length}</div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-6">
                                                    <div className="text-right">
                                                        <div className="text-xs text-white/40">耗时</div>
                                                        <div className="text-white font-mono">{stage.duration}</div>
                                                    </div>
                                                    <StatusBadge status={stage.status} size="sm" />
                                                </div>
                                            </div>
                                            {stage.status === 'failed' && pipeline.failureReason && (
                                                <div className="mt-4 p-4 bg-rose-500/10 border border-rose-500/20 rounded-lg">
                                                    <div className="flex items-start gap-3">
                                                        <Lucide name="AlertTriangle" size={16} className="text-rose-400 mt-0.5" />
                                                        <div>
                                                            <div className="text-sm font-bold text-rose-400 mb-1">失败原因</div>
                                                            <div className="text-xs text-rose-300/80 font-mono">{pipeline.failureReason}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Logs Content */}
                            {activeTab === 'logs' && (
                                <div className="bg-[#0A0A0A] border border-white/5 rounded-xl p-6 font-mono text-sm">
                                    <div className="space-y-2 text-white/60">
                                        <div><span className="text-white/30">[10:32:15]</span> <span className="text-indigo-400">AI</span> 正在分析代码变更影响范围...</div>
                                        <div><span className="text-white/30">[10:32:18]</span> <span className="text-blue-400">SYS</span> 检测到变更文件: ShippingCalculator.java</div>
                                        <div><span className="text-white/30">[10:32:20]</span> <span className="text-indigo-400">AI</span> 影响模块: OrderService, CheckoutController</div>
                                        <div><span className="text-white/30">[10:32:47]</span> <span className="text-emerald-400">OK</span> 影响分析完成</div>
                                        <div><span className="text-white/30">[10:32:48]</span> <span className="text-indigo-400">AI</span> 开始生成测试用例...</div>
                                        <div><span className="text-white/30">[10:33:33]</span> <span className="text-emerald-400">OK</span> 已生成 {pipeline.testsTotal} 个测试用例</div>
                                        <div><span className="text-white/30">[10:33:35]</span> <span className="text-blue-400">SYS</span> 启动 Docker 沙箱环境...</div>
                                        <div><span className="text-white/30">[10:33:40]</span> <span className="text-blue-400">SYS</span> 执行测试套件...</div>
                                        {pipeline.status === 'failed' && (
                                            <>
                                                <div><span className="text-white/30">[10:35:45]</span> <span className="text-rose-400">ERR</span> 测试失败: test_concurrent_inventory_deduct</div>
                                                <div><span className="text-white/30">[10:35:45]</span> <span className="text-rose-400">ERR</span> AssertionError: 期望库存 95，实际 90</div>
                                            </>
                                        )}
                                        {pipeline.status === 'success' && (
                                            <div><span className="text-white/30">[10:35:55]</span> <span className="text-emerald-400">OK</span> 所有测试通过 ({pipeline.testsPassed}/{pipeline.testsTotal})</div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Tests Content */}
                            {activeTab === 'tests' && (
                                <div className="bg-[#0F0F0F] border border-white/5 rounded-xl overflow-hidden">
                                    <div className="grid grid-cols-12 gap-4 p-4 border-b border-white/5 text-xs font-bold text-white/40 uppercase tracking-wider bg-white/[0.02]">
                                        <div className="col-span-1">状态</div>
                                        <div className="col-span-5">测试用例</div>
                                        <div className="col-span-4">描述</div>
                                        <div className="col-span-2 text-right">耗时</div>
                                    </div>
                                    <div className="divide-y divide-white/5">
                                        {['test_level1_shipping', 'test_level2_discount', 'test_level3_free', 'test_default_fee', 'test_boundary_cases'].map((test, idx) => (
                                            <div key={idx} className="grid grid-cols-12 gap-4 p-4 items-center hover:bg-white/[0.02]">
                                                <div className="col-span-1">
                                                    {idx < pipeline.testsPassed ? (
                                                        <Lucide name="CheckCircle2" size={16} className="text-emerald-400" />
                                                    ) : (
                                                        <Lucide name="XCircle" size={16} className="text-rose-400" />
                                                    )}
                                                </div>
                                                <div className="col-span-5 font-mono text-white/80">{test}</div>
                                                <div className="col-span-4 text-white/40 text-sm">验证用户等级运费计算逻辑</div>
                                                <div className="col-span-2 text-right text-white/40 font-mono text-sm">0.{Math.floor(Math.random() * 90) + 10}s</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main Pipeline List View ---
        const PipelineView = () => {
            const [statusFilter, setStatusFilter] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedPipeline, setSelectedPipeline] = useState(null);

            const filteredPipelines = PIPELINES.filter(p => {
                if (statusFilter !== 'all' && p.status !== statusFilter) return false;
                if (searchQuery && !p.branch.toLowerCase().includes(searchQuery.toLowerCase()) && !p.commitMsg.toLowerCase().includes(searchQuery.toLowerCase())) return false;
                return true;
            });

            if (selectedPipeline) {
                return (
                    <div className="min-h-screen bg-black text-slate-200">
                        <Navbar active="pipeline" />
                        <PipelineDetail pipeline={selectedPipeline} onBack={() => setSelectedPipeline(null)} />
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-black text-slate-200">
                    <Navbar active="pipeline" />
                    <div className="max-w-[1400px] mx-auto px-6 py-8 space-y-6 fade-in">
                        {/* Header */}
                        <div className="flex justify-between items-end">
                            <div className="space-y-1">
                                <h2 className="text-3xl font-bold text-white tracking-tight">流水线执行记录</h2>
                                <p className="text-white/40 text-sm">查看所有智能测试任务的执行历史与详细报告</p>
                            </div>
                            <a href="workspace.html" className="px-5 py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl text-sm font-bold flex items-center gap-2 transition-colors shadow-lg shadow-indigo-600/20">
                                <Lucide name="Play" size={16} /> 新建任务
                            </a>
                        </div>

                        {/* Filters */}
                        <div className="flex items-center justify-between gap-4 bg-[#0F0F0F] border border-white/5 rounded-xl p-4">
                            <div className="flex items-center gap-3">
                                {/* Status Filter */}
                                <div className="flex items-center bg-white/5 rounded-lg p-1 border border-white/5">
                                    {[
                                        { id: 'all', label: '全部' },
                                        { id: 'success', label: '成功' },
                                        { id: 'running', label: '运行中' },
                                        { id: 'failed', label: '失败' },
                                    ].map(filter => (
                                        <button
                                            key={filter.id}
                                            onClick={() => setStatusFilter(filter.id)}
                                            className={`px-3 py-1.5 rounded-md text-xs font-medium transition-all ${
                                                statusFilter === filter.id ? 'bg-white/10 text-white' : 'text-white/40 hover:text-white/80'
                                            }`}
                                        >
                                            {filter.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            {/* Search */}
                            <div className="relative w-72">
                                <Lucide name="Search" size={14} className="absolute left-3 top-2.5 text-white/30" />
                                <input
                                    type="text"
                                    placeholder="搜索分支或提交信息..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    className="w-full bg-black/50 border border-white/10 rounded-lg pl-9 pr-4 py-2 text-sm text-white placeholder-white/30 focus:outline-none focus:border-indigo-500/50"
                                />
                            </div>
                        </div>

                        {/* Pipeline List */}
                        <div className="bg-[#0F0F0F] border border-white/5 rounded-2xl overflow-hidden">
                            {/* Table Header */}
                            <div className="grid grid-cols-12 gap-4 p-5 border-b border-white/5 text-xs font-bold text-white/40 uppercase tracking-widest bg-white/[0.02]">
                                <div className="col-span-1">状态</div>
                                <div className="col-span-3">流水线</div>
                                <div className="col-span-2">项目</div>
                                <div className="col-span-2">阶段进度</div>
                                <div className="col-span-2">触发者</div>
                                <div className="col-span-1">耗时</div>
                                <div className="col-span-1 text-right">操作</div>
                            </div>

                            {/* Pipeline Rows */}
                            <div className="divide-y divide-white/5">
                                {filteredPipelines.map((pipeline) => (
                                    <div
                                        key={pipeline.id}
                                        className="grid grid-cols-12 gap-4 p-5 items-center hover:bg-white/[0.02] transition-colors group cursor-pointer"
                                        onClick={() => setSelectedPipeline(pipeline)}
                                    >
                                        <div className="col-span-1">
                                            <StatusBadge status={pipeline.status} size="sm" />
                                        </div>
                                        <div className="col-span-3">
                                            <div className="flex items-center gap-3">
                                                <span className="text-white font-bold group-hover:text-indigo-300 transition-colors">{pipeline.id}</span>
                                                <span className="px-2 py-0.5 bg-white/5 border border-white/10 rounded text-[10px] font-mono text-white/60 flex items-center gap-1">
                                                    <Lucide name="GitMerge" size={10} className="text-orange-400" /> {pipeline.branch}
                                                </span>
                                            </div>
                                            <div className="text-xs text-white/40 mt-1 truncate max-w-[280px]">{pipeline.commitMsg}</div>
                                        </div>
                                        <div className="col-span-2">
                                            <div className="text-sm text-white/60">{pipeline.project}</div>
                                        </div>
                                        <div className="col-span-2">
                                            <StageProgress stages={pipeline.stages} compact />
                                        </div>
                                        <div className="col-span-2">
                                            <div className="flex items-center gap-2">
                                                <div className="w-6 h-6 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 p-[1px]">
                                                    <img src={`https://api.dicebear.com/7.x/avataaars/svg?seed=${pipeline.triggeredBy}`} alt="" className="w-full h-full rounded-full bg-black" />
                                                </div>
                                                <div>
                                                    <div className="text-xs text-white/80">{pipeline.triggeredBy}</div>
                                                    <div className="text-[10px] text-white/30">{pipeline.triggeredAt}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="col-span-1">
                                            <span className="text-sm font-mono text-white/60">{pipeline.duration}</span>
                                        </div>
                                        <div className="col-span-1 text-right">
                                            <div className="flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                                {pipeline.status === 'failed' && (
                                                    <button className="p-1.5 hover:bg-indigo-500/20 rounded-lg text-indigo-400 transition-colors" title="重试" onClick={(e) => { e.stopPropagation(); }}>
                                                        <Lucide name="RotateCcw" size={14} />
                                                    </button>
                                                )}
                                                {pipeline.status === 'running' && (
                                                    <button className="p-1.5 hover:bg-rose-500/20 rounded-lg text-rose-400 transition-colors" title="取消" onClick={(e) => { e.stopPropagation(); }}>
                                                        <Lucide name="X" size={14} />
                                                    </button>
                                                )}
                                                <button className="p-1.5 hover:bg-white/10 rounded-lg text-white/40 hover:text-white transition-colors" title="查看详情">
                                                    <Lucide name="Eye" size={14} />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* Empty State */}
                            {filteredPipelines.length === 0 && (
                                <div className="p-16 text-center">
                                    <div className="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                        <Lucide name="Search" size={32} className="text-white/20" />
                                    </div>
                                    <div className="text-white/40 text-sm">没有找到匹配的流水线记录</div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PipelineView />);
    </script>
</body>

</html>
